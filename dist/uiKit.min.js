!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NIMUIKit=t():e.NIMUIKit=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";var n={};n.SessionList=i(1),n.FriendList=i(4),n.TeamList=i(5),e.exports=n},function(e,t,i){"use strict";function n(e){return e.to===o?e.from:e.to}var o,a=i(2),r=function(e){var t=e.parent,i=e.data,n=e.onclickitem||function(e,t){console.log("account:"+e+"---type:"+t)},r=e.onclickavatar||function(e,t){console.log("account:"+e+"---type:"+t)};o=i.account,this._body=document.createElement("ul"),this._body.className=e.clazz||"m-panel j-session",a.addEvent(this._body,"click",function(e){for(var t,i,o=this,s=e||window.event,l=s.srcElement||s.target;o!==l;){if("img"===l.tagName.toLowerCase()){var p=l.parentNode;return t=p.getAttribute("data-account"),i=p.getAttribute("data-type"),void r(t,i)}if("li"===l.tagName.toLowerCase()){t=l.getAttribute("data-account"),i=l.getAttribute("data-type"),a.removeClass(a.getNode(".j-session li.active"),"active"),a.addClass(l,"active");var c=l.querySelector(".count");return a.addClass(c,"hide"),c.innerHTML=0,void n(t,i)}l=l.parentNode}}),this.update(i),t&&this.inject(t)};r.prototype.inject=function(e){var t=a.getNode(e);t.innerHTML="",t.appendChild(this._body)},r.prototype.update=function(e){var t,i,r,l,p,c,m,f,g="",d=e.msgs,u=e.unreadmsgs,j=e.userinfo,_=e.teamInfo;if(0===d.length)g+='<p class="empty">暂无最近联系人哦</p>';else for(var v=0;v<d.length;v++){t=d[v],c=n(t),p=t.time,f=!1,m=0,u.hasOwnProperty(c)&&(m=u[c].count>99?"99+":u[c].count),f="99+"===m||m>0,"team"===t.scene?(i=_[c].name||c,r=_[c].type||"normal",l="images/"+r+".png"):(i=j[c].nick,l=a.getAvatar(j[c].avatar));var y=['<li data-gtype="'+r+'" data-type="'+t.scene+'" data-account="'+c+'">','<img src="'+l+'"/>','<div class="text">',"<p>","<span>"+i+"</span>",'<b class="time">'+a.transTime2(t.time)+"</b>","</p>","<p>",'<span class="first-msg">'+s(t,j,o)+"</span>",'<b class="count '+(f?"":"hide")+'">'+m+"</b>","</p>","</div>","</li>"].join("");g+=y}this._body.innerHTML=g},r.prototype.destory=function(){};var s=function(e,t,i){var n="p2p"!==e.scene?e.fromNick+":":"",o=e.type;if(!/text|image|file|audio|video|geo|custom|notification/i.test(o))return"";switch(o){case"text":n+=a.safeHtml(e.text),n=a.buildEmoji(n);break;case"image":n+="[图片]";break;case"file":n+=/exe|bat/i.test(e.file.ext)?"[非法文件，已被本站拦截]":"[文件]";break;case"audio":n+="[语音]";break;case"video":n+="[视频]";break;case"geo":n+="[位置]";break;case"custom":var r=JSON.parse(e.content);n+=1===r.type?"[猜拳]":2===r.type?"[阅后即焚]":3===r.type?"[贴图]":4===r.type?"[白板]":"[自定义消息]";break;case"notification":n="["+a.transNotification(e,t,i)+"]";break;default:n+="[未知消息类型]"}return n};e.exports=r},function(e,t,i){"use strict";var n=i(3),o=n.emoji,a={getNode:function(e){return this.isString(e)?document.querySelector(e):this.isElement(e)?e:void console.error("输入参数必须为node||String")},getNodes:function(e){return document.querySelectorAll(e)},isString:function(e){return"string"==typeof e},isElement:function(e){return!(!e||1!==e.nodeType)},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},addEvent:function(e,t,i){window.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},hasClass:function(e,t){return t=t||"",0===t.replace(/\s/g,"").length?!1:new RegExp(" "+t+" ").test(" "+e.className+" ")},addClass:function(e,t){e&&(this.hasClass(e,t)||(e.className+=" "+t))},removeClass:function(e,t){if(e&&this.hasClass(e,t)){for(var i=" "+e.className.replace(/[\t\r\n]/g,"")+" ";i.indexOf(" "+t+" ")>=0;)i=i.replace(" "+t+" "," ");e.className=i.replace(/^\s+|\s+$/g,"")}},safeHtml:function(){var e=/<br\/?>$/,t={r:/<|>|\&|\r|\n|\s|\'|\"/g,"<":"&lt;",">":"&gt;","&":"&amp;"," ":"&nbsp;",'"':"&quot;","'":"&#39;","\n":"<br/>","\r":""};return function(i){return i=r(t,i),i.replace(e,"<br/><br/>")}}(),getAvatar:function(e){var t=/^((http|https|ftp):\/\/)?(\w(\:\w)?@)?([0-9a-z_-]+\.)*?([a-z0-9-]+\.[a-z]{2,6}(\.[a-z]{2})?(\:[0-9]{2,6})?)((\/[^?#<>\/\\*":]*)+(\?[^#]*)?(#.*)?)?$/i;return t.test(e)?e:"images/default-icon.png"},buildEmoji:function(e){for(var t=/\[([^\]\[]*)\]/g,i=e.match(t)||[],n=0,a=i.length;a>n;++n)o[i[n]]&&(e=e.replace(i[n],'<img class="emoji" src="images/emoji/'+o[i[n]].file+'" />'));return e},transNotification:function(e,t,i){var n,o,a,r=e.attach.type,s=e.from===i?!0:!1,l=[];switch(r){case"addTeamMembers":for(o=e.attach.accounts,a=0;a<o.length;a++)o[a]===i?l.push("你"):l.push(t[o[a]].nick);l=l.join(","),n=s?"你将"+l+"加群":l+"加入群";break;case"removeTeamMembers":for(o=e.attach.accounts,a=0;a<o.length;a++)o[a]===i?l.push("你"):l.push(t[o[a]].nick);l=l.join(","),n=s?"你将"+l+"移除群":l+"被移除群";break;case"leaveTeam":l=e.from===i?"你":e.fromNick,n=l+"退出了群";break;case"updateTeam":var p=e.from===i?"你":e.fromNick||e.from;n=p+"更新群名为"+e.attach.team.name;break;default:n="群消息"}return n},transTime:function(){var e=function(e){e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.setHours(0);var t=e.getTime();e.setMonth(1),e.setDate(1);var i=e.getTime();return[t,i]};return function(t){var i=e(new Date);return t>=i[0]?s(t,"HH:mm"):t<i[0]&&t>=i[1]?s(t,"MM-dd HH:mm"):s(t,"yyyy-MM-dd HH:mm")}}(),transTime2:function(){var e=function(e){e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.setHours(0);var t=e.getTime();e.setMonth(1),e.setDate(1);var i=e.getTime();return[t,i]};return function(t){var i=e(new Date);return t>=i[0]?s(t,"HH:mm"):t>=i[0]-864e5?"昨天":t>=i[0]-1728e5?"前天":t>=i[0]-6048e5?"星期"+s(t,"w"):t>=i[1]?s(t,"MM-dd"):s(t,"yyyy-MM-dd")}}()},r=function(e,t){return t=""+t,e&&t?t.replace(e.r,function(t){var i=e[e.i?t:t.toLowerCase()];return null!=i?i:t}):t||""},s=function(){var e={i:!0,r:/\byyyy|yy|MM|cM|eM|M|dd|d|HH|H|mm|ms|ss|m|s|w|ct|et\b/g},t=["上午","下午"],i=["A.M.","P.M."],n=["日","一","二","三","四","五","六"],o=["一","二","三","四","五","六","七","八","九","十","十一","十二"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],s=function(e){return e=parseInt(e,10)||0,(10>e?"0":"")+e},l=function(e){return 12>e?0:1};return function(p,c,m){if(!p||!c)return"";p=new Date(p),e.yyyy=p.getFullYear(),e.yy=(""+e.yyyy).substr(2),e.M=p.getMonth()+1,e.MM=s(e.M),e.eM=a[e.M-1],e.cM=o[e.M-1],e.d=p.getDate(),e.dd=s(e.d),e.H=p.getHours(),e.HH=s(e.H),e.m=p.getMinutes(),e.mm=s(e.m),e.s=p.getSeconds(),e.ss=s(e.s),e.ms=p.getMilliseconds(),e.w=n[p.getDay()];var f=l(e.H);return e.ct=t[f],e.et=i[f],m&&(e.H=e.H%12),r(e,c)}}();e.exports=a},function(e,t){"use strict";var i={};i.emoji={"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[汗]":{file:"emoji_145.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"},"[雷]":{file:"emoji_54.png"},"[雨]":{file:"emoji_55.png"},"[雪花]":{file:"emoji_56.png"},"[爱人]":{file:"emoji_57.png"},"[帽子]":{file:"emoji_58.png"},"[皇冠]":{file:"emoji_59.png"},"[篮球]":{file:"emoji_60.png"},"[足球]":{file:"emoji_61.png"},"[垒球]":{file:"emoji_62.png"},"[网球]":{file:"emoji_63.png"},"[台球]":{file:"emoji_64.png"},"[咖啡]":{file:"emoji_65.png"},"[啤酒]":{file:"emoji_66.png"},"[干杯]":{file:"emoji_67.png"},"[柠檬汁]":{file:"emoji_68.png"},"[餐具]":{file:"emoji_69.png"},"[汉堡]":{file:"emoji_70.png"},"[鸡腿]":{file:"emoji_71.png"},"[面条]":{file:"emoji_72.png"},"[冰淇淋]":{file:"emoji_73.png"},"[沙冰]":{file:"emoji_74.png"},"[生日蛋糕]":{file:"emoji_75.png"},"[蛋糕]":{file:"emoji_76.png"},"[糖果]":{file:"emoji_77.png"},"[葡萄]":{file:"emoji_78.png"},"[西瓜]":{file:"emoji_79.png"},"[光碟]":{file:"emoji_80.png"},"[手机]":{file:"emoji_81.png"},"[电话]":{file:"emoji_82.png"},"[电视]":{file:"emoji_83.png"},"[声音开启]":{file:"emoji_84.png"},"[声音关闭]":{file:"emoji_85.png"},"[铃铛]":{file:"emoji_86.png"},"[锁头]":{file:"emoji_87.png"},"[放大镜]":{file:"emoji_88.png"},"[灯泡]":{file:"emoji_89.png"},"[锤头]":{file:"emoji_90.png"},"[烟]":{file:"emoji_91.png"},"[炸弹]":{file:"emoji_92.png"},"[枪]":{file:"emoji_93.png"},"[刀]":{file:"emoji_94.png"},"[药]":{file:"emoji_95.png"},"[打针]":{file:"emoji_96.png"},"[钱袋]":{file:"emoji_97.png"},"[钞票]":{file:"emoji_98.png"},"[银行卡]":{file:"emoji_99.png"},"[手柄]":{file:"emoji_100.png"},"[麻将]":{file:"emoji_101.png"},"[调色板]":{file:"emoji_102.png"},"[电影]":{file:"emoji_103.png"},"[麦克风]":{file:"emoji_104.png"},"[耳机]":{file:"emoji_105.png"},"[音乐]":{file:"emoji_106.png"},"[吉他]":{file:"emoji_107.png"},"[火箭]":{file:"emoji_108.png"},"[飞机]":{file:"emoji_109.png"},"[火车]":{file:"emoji_110.png"},"[公交]":{file:"emoji_111.png"},"[轿车]":{file:"emoji_112.png"},"[出租车]":{file:"emoji_113.png"},"[警车]":{file:"emoji_114.png"},"[自行车]":{file:"emoji_115.png"}},e.exports=i},function(e,t,i){"use strict";var n,o=i(2),a=function(e){var t=e.parent,i=e.data,a=e.onclickitem||function(e,t){console.log("account:"+e+"---type:"+t)},r=e.onclickavatar||function(e,t){console.log("account:"+e+"---type:"+t)};n=i.account,this._body=document.createElement("ul"),this._body.className=e.clazz||"m-panel j-friend",o.addEvent(this._body,"click",function(e){for(var t,i,n=this,s=e||window.event,l=s.srcElement||s.target;n!==l;){if("img"===l.tagName.toLowerCase()){var p=l.parentNode;return t=p.getAttribute("data-account"),i=p.getAttribute("data-type"),void r(t,i)}if("li"===l.tagName.toLowerCase())return t=l.getAttribute("data-account"),i=l.getAttribute("data-type"),o.removeClass(o.getNode(".j-friend li.active"),"active"),o.addClass(l,"active"),void a(t,i);l=l.parentNode}}),this.update(i),t&&this.inject(t)};a.prototype.inject=function(e){var t=o.getNode(e);t.innerHTML="",t.appendChild(this._body)},a.prototype.update=function(e){for(var t="",i=e.friends,a=0;a<i.length;a++)i[a].account!==n&&(t+=['<li data-type="p2p" data-account="'+i[a].account+'">','<img src="'+o.getAvatar(i[a].avatar)+'"/>','<div class="text">','<p class="nick">',"<span>"+i[a].nick+"</span>","</p>","</div>","</li>"].join(""));this._body.innerHTML=t},a.prototype.destory=function(){},e.exports=a},function(e,t,i){"use strict";var n=i(2),o=function(e){var t=e.parent,i=e.data,o=e.onclickitem||function(e,t){console.log("account:"+e+"---type:"+t)},a=e.onclickavatar||function(e,t){console.log("account:"+e+"---type:"+t)};this._body=document.createElement("ul"),this._body.className=e.clazz||"m-panel j-team",n.addEvent(this._body,"click",function(e){for(var t,i,r=this,s=e||window.event,l=s.srcElement||s.target;r!==l;){if("img"===l.tagName.toLowerCase()){var p=l.parentNode;return t=p.getAttribute("data-account"),i=p.getAttribute("data-type"),void a(t,i)}if("li"===l.tagName.toLowerCase())return t=l.getAttribute("data-account"),i=l.getAttribute("data-type"),n.removeClass(n.getNode(".j-team li.active"),"active"),n.addClass(l,"active"),void o(t,i);l=l.parentNode}}),this.update(i),t&&this.inject(t)};o.prototype.inject=function(e){var t=n.getNode(e);t.innerHTML="",t.appendChild(this._body)},o.prototype.update=function(e){var t='<div class="team normal-team"><div class="team-title">普通群</div><ul id="normalTeam">',i='<div class="team advanced-team"><div class="team-title">高级群</div><ul id="advanceTeam">',n=!1,o=!1,a="",r=e.teams;if(r&&r.length>0){for(var s=0,l=r.length;l>s;++s)"normal"===r[s].type?(n=!0,t+='<li data-gtype="normal" data-type="team" data-account="'+r[s].teamId+'"><img src="images/normal.png"/><div class="text">',t+='<p class="nick"><span>'+r[s].name||r[s].teamId+'</span><b class="hide count"></b></p><p class="first-msg"></p></div></li>'):"advanced"===r[s].type&&(o=!0,i+='<li data-gtype="advanced" data-type="team" data-account="'+r[s].teamId+'"><img src="images/advanced.png"/><div class="text">',i+='<p class="nick"><span>'+r[s].name||r[s].teamId+'</span><b class="hide count"></b></p><p class="first-msg"></p></div></li>');t+="</ul></div>",i+="</ul></div>",a=n&&o?i+t:n&&!o?t:!n&&o?i:"<p>暂时还没有群哦</p>"}else a="<p>暂时还没有群哦</p>";this._body.innerHTML=a},o.prototype.destory=function(){},e.exports=o}])});